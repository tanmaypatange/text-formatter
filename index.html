<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text Utility Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .text-section {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        .text-label {
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        textarea {
            width: 100%;
            resize: vertical;
            min-height: 200px;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .counter {
            color: #666;
            font-size: 14px;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            background-color: #2196F3;
            color: white;
        }
        .btn:hover:not(.btn-disabled) {
            background-color: #1E88E5;
        }
        .btn-disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .btn-secondary {
            background-color: #4CAF50;
        }
        .btn-secondary:hover {
            background-color: #45a049;
        }
        #copyConfirmation, #processConfirmation {
            color: #4CAF50;
            margin-left: 10px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #exportError {
            color: red;
            margin-left: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Input Section -->
        <div class="text-section">
            <div class="text-label">Input Your Text</div>
            <textarea id="inputTextArea" placeholder="Paste your text here."></textarea>
            <div class="action-buttons">
                <div class="counter" id="inputCounter">Characters: 0 | Words: 0</div>
                <button id="copyInputButton" class="btn">Copy Text</button>
                <button id="clearInputButton" class="btn">Clear Text</button>
                <button id="removeContractionsButton" class="btn btn-secondary">Remove Contractions</button>
                <span id="processConfirmation">Processed!</span>
            </div>
        </div>

        <!-- Output Section -->
        <div class="text-section">
            <div class="text-label">Output Text</div>
            <textarea id="outputTextArea" readonly placeholder="Processed text will appear here."></textarea>
            <div class="action-buttons">
                <div class="counter" id="outputCounter">Characters: 0 | Words: 0</div>
                <button id="copyOutputButton" class="btn">Copy Text</button>
                <button id="clearOutputButton" class="btn">Clear Text</button>
                <button id="addContractionsButton" class="btn btn-secondary">Add Contractions</button>
                <button id="txtButton" class="btn btn-disabled" disabled>Download TXT</button>
                <button id="pdfButton" class="btn btn-disabled" disabled>Download PDF</button>
                <span id="copyConfirmation">Copied!</span>
                <span id="exportError"></span>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const inputTextArea = document.getElementById('inputTextArea');
        const outputTextArea = document.getElementById('outputTextArea');
        const inputCounter = document.getElementById('inputCounter');
        const outputCounter = document.getElementById('outputCounter');
        const copyInputButton = document.getElementById('copyInputButton');
        const clearInputButton = document.getElementById('clearInputButton');
        const copyOutputButton = document.getElementById('copyOutputButton');
        const clearOutputButton = document.getElementById('clearOutputButton');
        const removeContractionsButton = document.getElementById('removeContractionsButton');
        const addContractionsButton = document.getElementById('addContractionsButton');
        const txtButton = document.getElementById('txtButton');
        const pdfButton = document.getElementById('pdfButton');
        const copyConfirmation = document.getElementById('copyConfirmation');
        const processConfirmation = document.getElementById('processConfirmation');
        const exportError = document.getElementById('exportError');

        // Contraction Mappings
        const contractions = {
            "are not": "aren't",
            "cannot": "can't",
            "could not": "couldn't",
            "did not": "didn't",
            "does not": "doesn't",
            "do not": "don't",
            "had not": "hadn't",
            "has not": "hasn't",
            "have not": "haven't",
            "he would": "he'd",
            "he will": "he'll",
            "he is": "he's",
            "i would": "i'd",
            "i will": "i'll",
            "i am": "i'm",
            "i have": "i've",
            "is not": "isn't",
            "it is": "it's",
            "let us": "let's",
            "she would": "she'd",
            "she will": "she'll",
            "she is": "she's",
            "should not": "shouldn't",
            "that is": "that's",
            "there is": "there's",
            "they would": "they'd",
            "they will": "they'll",
            "they are": "they're",
            "they have": "they've",
            "was not": "wasn't",
            "we would": "we'd",
            "we are": "we're",
            "were not": "weren't",
            "what will": "what'll",
            "what are": "what're",
            "what is": "what's",
            "what have": "what've",
            "where is": "where's",
            "who would": "who'd",
            "who will": "who'll",
            "who are": "who're",
            "who is": "who's",
            "who have": "who've",
            "will not": "won't",
            "would not": "wouldn't",
            "you would": "you'd",
            "you will": "you'll",
            "you are": "you're",
            "you have": "you've"
        };

        // Utility Functions
        function updateCounter(textArea, counterElement) {
            const plainText = textArea.value;
            const charCount = plainText.length;
            const wordCount = plainText.trim().split(/\s+/).filter(word => word.length > 0).length;
            counterElement.textContent = `Characters: ${charCount} | Words: ${wordCount}`;
        }

        function showConfirmation(element) {
            element.style.opacity = '1';
            setTimeout(() => {
                element.style.opacity = '0';
            }, 2000);
        }

        function copyText(textArea, confirmationElement) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textArea.value;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            showConfirmation(confirmationElement);
        }

        function checkExportButtons() {
            const hasContent = outputTextArea.value.trim() !== '';
            txtButton.disabled = !hasContent;
            pdfButton.disabled = !hasContent;
            txtButton.classList.toggle('btn-disabled', !hasContent);
            pdfButton.classList.toggle('btn-disabled', !hasContent);
        }

        function removeContractionsFromText(text) {
            return text.replace(/\b(can't|won't|ain't|\w+n't|\w+'(?:m|s|ve|re|ll|d))\b/gi, (match) => {
                const lowerMatch = match.toLowerCase();
                const replacement = Object.keys(contractions).find(key => 
                    contractions[key].toLowerCase() === lowerMatch
                );
                
                if (replacement) {
                    return match[0] === match[0].toUpperCase() 
                        ? replacement[0].toUpperCase() + replacement.slice(1)
                        : replacement;
                }
                
                return match;
            });
        }

        function addContractionsToText(text) {
            let processedText = text;
            Object.entries(contractions).forEach(([expanded, contracted]) => {
                // Create a regex that matches the expanded form with word boundaries
                const regex = new RegExp(`\\b${expanded}\\b`, 'gi');
                processedText = processedText.replace(regex, (match) => {
                    // Preserve original case
                    return match[0] === match[0].toUpperCase() 
                        ? contracted[0].toUpperCase() + contracted.slice(1)
                        : contracted;
                });
            });
            return processedText;
        }

        // Event Listeners
        inputTextArea.addEventListener('input', () => {
            updateCounter(inputTextArea, inputCounter);
        });

        outputTextArea.addEventListener('input', () => {
            updateCounter(outputTextArea, outputCounter);
            checkExportButtons();
        });

        // Input Text Buttons
        copyInputButton.addEventListener('click', () => {
            copyText(inputTextArea, copyConfirmation);
        });

        clearInputButton.addEventListener('click', () => {
            inputTextArea.value = '';
            updateCounter(inputTextArea, inputCounter);
        });

        removeContractionsButton.addEventListener('click', () => {
            outputTextArea.value = removeContractionsFromText(inputTextArea.value);
            updateCounter(outputTextArea, outputCounter);
            showConfirmation(processConfirmation);
            checkExportButtons();
        });

        // Output Text Buttons
        copyOutputButton.addEventListener('click', () => {
            copyText(outputTextArea, copyConfirmation);
        });

        clearOutputButton.addEventListener('click', () => {
            outputTextArea.value = '';
            updateCounter(outputTextArea, outputCounter);
            checkExportButtons();
        });

        addContractionsButton.addEventListener('click', () => {
            outputTextArea.value = addContractionsToText(inputTextArea.value);
            updateCounter(outputTextArea, outputCounter);
            showConfirmation(processConfirmation);
            checkExportButtons();
        });

        // Export Buttons
        txtButton.addEventListener('click', () => {
            if (outputTextArea.value.trim() === '') {
                exportError.textContent = 'Nothing to export. Document is blank.';
                setTimeout(() => { exportError.textContent = ''; }, 2000);
                return;
            }
            const blob = new Blob([outputTextArea.value], {type: "text/plain;charset=utf-8"});
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "document.txt";
            link.click();
        });

        pdfButton.addEventListener('click', () => {
            if (outputTextArea.value.trim() === '') {
                exportError.textContent = 'Nothing to export. Document is blank.';
                setTimeout(() => { exportError.textContent = ''; }, 2000);
                return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const lines = outputTextArea.value.split('\n');
            doc.setFontSize(12);
            doc.text(lines, 10, 10);
            doc.save("document.pdf");
        });

        // Initial setup
        checkExportButtons();
    </script>
</body>
</html>
